<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CubeMon-Vue-Demo-STM32F407VGT6U: CubeMonitor+Vue Demo (MCU program)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CubeMon-Vue-Demo-STM32F407VGT6U
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">CubeMonitor+Vue Demo (MCU program) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="mainpage"></a></p>
<p >Demonstration video:</p>
<p >This project is a part of a larger project <em>CubeMonitor+Vue Demo</em>. This part contains the code for MCU created with HAL libraries, in this for STM32F407 evaluation board. In case you do not have STM32F407 evaluation board, you can port the program to any STM32 MCU as the Cube Monitor only cares about variable names/addresses.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Motivation</h1>
<p >The CubeMonitor tool enables program runtime monitoring using NodeRed. With the NodeRed 'function-block-like' programming and preconfigured elements (like LEDs for input status or dial for analog input and even a <em>write</em> table for variable setting) you can create simple dashboards. As long as you want only few inputs and you do not really care about setting a lot of variables manually, this is completely fine. <br  />
</p>
<p >I did not really like the dashboard (it got pretty full and laggy after a while) and the way how it is created (I guess a lot of C/C++ programmers somehow dislike visual programing and wiring function blocks with mouse). I was also missing a simple way how to set variables using graphical elements like toggle switching.</p>
<p >That is why I decided to use the NodeRed ui-builder plugin to create a custom UI with all the inputs/outputs/information I want.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Setup</h1>
<p >You will need:</p><ul>
<li>STM32F407 Discovery board or any other evaluation board</li>
<li>STM IDE (turns out the Atollic and STM IDE are not really back-compatible, the program configuration is deleted after you import a program created with CubeIDE into Atollic)</li>
</ul>
<p >Steps (option 1 - importing the project): 1) Fork and clone this repository 2) Import the project into STM IDE 3) Build and flash the board. The project setting should be imported as well but just to be sure those are the <code>gcc</code> options I have used </p><pre class="fragment">```
-mcpu=cortex-m4 -std=gnu11 -g3 -DDEBUG -DUSE_HAL_DRIVER -DSTM32F407xx -c -I../Core/Inc -I../Drivers/STM32F4xx_HAL_Driver/Inc -I../Drivers/STM32F4xx_HAL_Driver/Inc/Legacy -I../Drivers/CMSIS/Device/ST/STM32F4xx/Include -I../Drivers/CMSIS/Include -O0 -ffunction-sections -fdata-sections -Wall -fstack-usage --specs=nano.specs -mfpu=fpv4-sp-d16 -mfloat-abi=hard -mthumb
``` 
</pre><p> Steps (option 2 - just flashing the board): 1) Fork and clone this repository 2) Use the Release.hex file in the /Release folder to flash the board (using for example ST-link)</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Structure</h1>
<p >There are two main parts of the program</p><ul>
<li>lib<ul>
<li>the libraries <b>do not</b> modify HW setting of the peripherials. This is handled completely by the HAL code generation. They do the heavy lifting for falling/raising edge detections, short/long button presses or analog input scaling.</li>
</ul>
</li>
<li>prog<ul>
<li>uses the libraries from <em>lib</em> to initialize used peripherials in <a class="el" href="init_8c.html" title="Initialization of digital/analog inputs and outputs.">init.c</a> file</li>
<li>handles the program logic created to demonstrate the CubeMonitor+Vue Demo functionality</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Function</h1>
<p >A seamingly nonsence logic is defined, but bear with me, it demonstrates the CubeMonitors functions quite well.</p>
<p >The STM32F407 Discovery board user button actions changes a counter variable programData.mx_counter:</p><ul>
<li>a single click (<a class="el" href="di_8h.html#ae4185de0611299f7640e8845a0cf6123a4a45a0331bd38abe5259532ddcf30567">INPUT_ACT_SHORT_PRESS</a>) will increase counter variable by one</li>
<li>when pressed down (<a class="el" href="di_8h.html#ae4185de0611299f7640e8845a0cf6123abef305534f7c867cac91936bdf6c1e43">INPUT_ACT_LONG_PRESS</a>), the counter increases by 1 every second</li>
<li>on double click (<a class="el" href="di_8h.html#ae4185de0611299f7640e8845a0cf6123a01daddeda946177684552f6863dd581c">INPUT_ACT_DOUBLE_PRESS</a>), it resets to 0</li>
</ul>
<p >Two digital inputs are defined:</p><ul>
<li><a class="el" href="init_8h.html#ae0e1e8a550c2df80e0cdf932d1c801c8aff98c742a9753233d062053ac709680d">DI_1</a> (PE7, active high)</li>
<li><a class="el" href="init_8h.html#ae0e1e8a550c2df80e0cdf932d1c801c8aa3759e2bfec65a77b25ed9c66398c8e7">DI_2</a> (PE8, active low)</li>
</ul>
<p >If both of them are in ON state, <a class="el" href="init_8h.html#ab08563685e3f72da1ec746d90b9d2ee4af073993d4e7554338be6ae5f26fa21bf">DO_LED_RED</a> is on.</p>
<p >Two analog inputs are defined</p><ul>
<li><a class="el" href="init_8h.html#a2f9151779bef920531801f8e3e82b1c3a977bb92793565bafcd9f1a20f606d48e">AI_1</a> (PA1) is reading a potentiometer output with range 0-3.3V</li>
<li><a class="el" href="init_8h.html#a2f9151779bef920531801f8e3e82b1c3a2405b54996f098f921bd7af89fe558a5">AI_2</a> (PA2) is reading a potentiometer output with range 0-5V</li>
</ul>
<p >Two analog outputs are defined</p><ul>
<li><a class="el" href="init_8h.html#a06907935799fd982c7fda8ede68d952da5ab468c179cc89b906ba05a13ea36979">AO_1</a> (PA4) is outputing a <em>reversed</em> value of <a class="el" href="init_8h.html#a2f9151779bef920531801f8e3e82b1c3a977bb92793565bafcd9f1a20f606d48e">AI_1</a><ul>
<li>example: a value 2.5V was measured on <a class="el" href="init_8h.html#a2f9151779bef920531801f8e3e82b1c3a977bb92793565bafcd9f1a20f606d48e">AI_1</a>, 3.3V-2.5V=0.8V is on the <a class="el" href="init_8h.html#a06907935799fd982c7fda8ede68d952da5ab468c179cc89b906ba05a13ea36979">AO_1</a> output</li>
</ul>
</li>
<li><a class="el" href="init_8h.html#a06907935799fd982c7fda8ede68d952da3c84e8d7f3cf4fdbaa377586758a7403">AO_2</a> (PA5) currently without function</li>
</ul>
<p >The program utilize the STM32F407 Discovery board LED</p><ul>
<li><a class="el" href="init_8h.html#ab08563685e3f72da1ec746d90b9d2ee4a4e4fc47e44c6f9d05fd17cdb8239ccb0">DO_LED_ORANGE</a> (PD13)<ul>
<li>toggles on and off every second</li>
</ul>
</li>
<li><a class="el" href="init_8h.html#ab08563685e3f72da1ec746d90b9d2ee4af073993d4e7554338be6ae5f26fa21bf">DO_LED_RED</a> (PD14)<ul>
<li>is on if both <a class="el" href="init_8h.html#ae0e1e8a550c2df80e0cdf932d1c801c8aff98c742a9753233d062053ac709680d">DI_1</a> and <a class="el" href="init_8h.html#ae0e1e8a550c2df80e0cdf932d1c801c8aa3759e2bfec65a77b25ed9c66398c8e7">DI_2</a> are on</li>
</ul>
</li>
<li><a class="el" href="init_8h.html#ab08563685e3f72da1ec746d90b9d2ee4a3e9b81989367ea069294295c7a0d9c42">DO_LED_BLUE</a> (PD15)<ul>
<li>is on if <a class="el" href="structprogram_data.html#a107d702f4c4bae01ef87f2553c826c6b">programData::mx_counter</a> is even number, off if it is odd </li>
</ul>
</li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
